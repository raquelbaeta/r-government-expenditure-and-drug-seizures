---
title: "Multiple Regression and Causal Analysis"
author: "Raquel Baeta"
date: '2022-06-12'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r load_packages}
library(readr)
library(ggplot2)
library(corrplot)
library(stargazer)
```

```{r load_dataset}
baeta_data <- read_csv("baeta_data.csv", show_col_types = FALSE)
```

```{r data_for_2017}
# pull put the year 2017 and make a new data frame 
df_2017 <- baeta_data[which(baeta_data$year == "2017"),]
```

```{r removing_nas}
df_2017 <- na.omit(df_2017)
```

```{r first_look_at_data, include=FALSE}
str(df_2017) # structure 
dim(df_2017) # dimension 
head(df_2017) # first few rows 
summary(df_2017) # summary 
```

####
# Univariate analysis 
####

# Figure 1: A bar plot of the raw variable of ‘government expenditure’ from the World Bank.

```{r raw_barplot_exp, include=TRUE}
barplot(df_2017$exp,
        xlab = "Countries", 
        ylab = "Government Expenditure",
        main = "Government Expenditure: A brief overview")
```

# Figure 2: A bar plot of the raw variable ‘gdp’ from the World Bank.

```{r raw_barplot_gdp, include=TRUE}
barplot(df_2017$gdp,
        xlab = "Countries", 
        ylab = "Gross Domestic Product (GDP)",
        main = "Gross Domestic Product (GDP): A Brief overview")
```

# Figure 3: A bar plot of ‘all_drugs’ that includes cannabis, cocaine and opioid seizures from the UNODC.

```{r raw_barplot_alldrugs, include=TRUE}
barplot(df_2017$all_drugs,
        xlab = "Countries", 
        ylab = "All drugs: number of seziures",
        main = "All drugs: A Brief overview")
```

# Figure 4: A bar plot of the variable ‘un1’ of number of states that have signed (0) or haven’t signed (1). 

```{r un1_histo, include=TRUE}
# un1
hist(df_2017$un1,
     xlab = "Countries that have signed the 1961 treaty", 
     ylab = "Countries",
     main = "Single Convention on Narcotic Drugs (1961): A Brief overview")
```

```{r contingency_table, include=FALSE}
summary(df_2017$exp) # government expenditure 
summary(df_2017$gdp) # gross domestic product 
summary(df_2017$all_drugs) # cannabis, cocaine and opioids
```

```{r coutnries_signed}
signed <- df_2017[which(df_2017$un1 == "1"),]
```

```{r countries_nonsign}
not_signed <- df_2017[which(df_2017$un1 == "0"),]
```

####
####
# Transfromed variables
####
####

# Figure 5: A bar plot of the transformed variable of ‘government expenditure’ from the World Bank.

```{r transfromed_exp_barplot}
barplot(df_2017$exp_ln,
        xlab = "Countries", 
        ylab = "Government Expenditure",
        main = "Government Expenditure (ln): A brief overview")
```

# Figure 6: A bar plot of the transformed variable of ‘gdp’ from the World Bank.

```{r transformed_gdp_barplot}
barplot(df_2017$gdp_ln,
        xlab = "Countries", 
        ylab = "Gross Domestic Product (GDP)",
        main = "Gross Domestic Product (GDP) (ln): A Brief overview")
```


```{r transformedcontingency_table, include=FALSE}
summary(df_2017$exp_ln) # government expenditure 
summary(df_2017$gdp_ln) # gross domestic product 
```

####
####
# Bivariate analysis 
####
####

```{r dataframe_correlation_matrix}
drugsdf <- subset(df_2017, select = c(exp_ln, all_drugs, gdp_ln, un1) )
```

```{r workingout_correlation, include=TRUE}
drugs.cor = cor(drugsdf)
```

# Figure 7: A correlation matrix of variables: ‘government expenditure’, ‘all drugs’, ‘gdp’, and ‘un1’.

```{r correlation_matrix_plot}
corrplot(drugs.cor)
```

```{r correlation_matrix_table, include=FALSE}
correlation.matrix <- cor(drugsdf[,c("all_drugs","exp_ln","gdp_ln", "un1")])
stargazer(correlation.matrix, title="Correlation Matrix", type = "html")
```

# Figure 8: A scatterplot matrix of variables: ‘government expenditure’, ‘all drugs’, ‘gdp’, and ‘un1’.

```{r scatterplot_matrix}
plot(drugsdf, main = "Scatterplot matrix of all variables")
```

####
####
# Effect decomposition
####
####

# A bivariate regression: 'all drugs' and 'government expenditure'

```{r bivariate_drugs_exp}
lm.out <- summary(lm(all_drugs ~  exp_ln, data=drugsdf))
lm.out
```

# A multiple regression: 'all drugs', 'government expenditure' and 'GDP'

```{r multiple_drugs_exp_gdp}
lm.out2 <- lm(all_drugs ~  exp_ln + gdp_ln, data=drugsdf)
summary(lm.out)
```

# A multiple regression: 'all drugs', 'government expenditure' and 'United Nations Drug Control Treaty'

```{r mulitple_drugs_exp_un}
lm.out3 <- lm(all_drugs ~  exp_ln + un1, data=drugsdf)
summary(lm.out3)
```

# A multiple regression: 'all drugs', 'government expenditure', 'GDP' and 'United Nations Drug Control Treaty'

```{r mulitple_drugs_exp_gdp_un}
lm.out4 <- lm(all_drugs ~  exp_ln + gdp_ln + un1, data=drugsdf)
summary(lm.out4)
```

```{r regression_table, include=FALSE}
stargazer(lm.out2, lm.out3, lm.out4,
          title="Regression Results", 
          dep.var.labels =c("Drug seizures"),
          covariate.labels = c("Government Eexpenditure",
                               "Gross Domestic Product", 
                               "United Nation Drug Control Treaty"), 
          omit.stat=c("LL","ser","f"), 
          ci=TRUE, 
          ci.level=0.90, 
          single.row=TRUE)
```

```{r regression_plot}
par(mfrow=c(2,2)) # splits window
plot(lm.out4, cex.caption=0.6, cex.id=0.6,
     main = "Regression Plot")
```
